\usepackage[utf8]{inputenc}
\usepackage[british]{babel}
\frenchspacing % remove ugly additional space after periods

% maths
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{mleftright}
\mleftright

% figures and tables
\usepackage{booktabs}
\usepackage{graphicx}
\usepackage{xcolor}

% typography
\usepackage[stretch=12, shrink=12]{microtype}
\usepackage[detect-all]{siunitx}
\usepackage[en-GB]{datetime2}
\usepackage{bm}
\usepackage{eucal}

\definecolor{linkcolor}{rgb}{0,0,0.65}
\usepackage[%
    pdftex,
    colorlinks=true,
    pdfstartview=FitV,
    linkcolor=linkcolor,
    citecolor=linkcolor,
    urlcolor=linkcolor,
    hyperindex=true,
    hyperfigures=true]{hyperref}

% macros
\usepackage{xparse}
% new commands
\newcommand\figref[1]{Fig.~\ref{#1}}
\newcommand{\logL}{\mathcal{L}}
\newcommand{\partit}{\mathcal{Z}}
%% redefinitions
\renewcommand{\theta}{\vartheta}
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\phi}{\varphi}
\renewcommand{\hbar}{\hslash}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\renewcommand{\Re}{\operatorname{Re}}
\renewcommand{\Im}{\operatorname{Im}}
%% special operators
\newcommand{\op}[1]{\hat{#1}}
\newcommand{\I}{\mathbb{I}}
% redef cos to have same height as sin
\protected\def\arccos{\qopname\relax o{\vphantom{i}arccos}}
\protected\def\cos{\qopname\relax o{\vphantom{i}cos}}
%% special sets
\newcommand{\Cc}{\mathbb{C}}
\newcommand{\Rr}{\mathbb{R}}
\newcommand{\Nn}{\mathbb{N}}
%% vectors
\renewcommand{\vec}[1]{\bm{#1}}
\newcommand{\uvec}[1]{\vec{\hat{#1}}}
\newcommand{\matr}[1]{\bm{#1}}
%% derivatives
\newcommand{\dd}{d}
\NewDocumentCommand{\diff}{s o m m}{%
    \IfBooleanTF{#1}%
        {\dd\IfValueT{#2}{^{#2}} #3 / %
         \dd #4\IfValueT{#2}{^{#2}}}%
        {\frac{\dd\IfValueT{#2}{^{#2}} #3}%
              {\dd #4\IfValueT{#2}{^{#2}}}}}
\NewDocumentCommand{\pdiff}{s o m m}{%
    \IfBooleanTF{#1}%
        {\partial\IfValueT{#2}{^{#2}} #3 / %
         \partial #4\IfValueT{#2}{^{#2}}}%
        {\frac{\partial\IfValueT{#2}{^{#2}} #3}%
              {\partial #4\IfValueT{#2}{^{#2}}}}}
%% delimiters
\DeclarePairedDelimiter\ABS{\lvert}{\rvert}
% add star when following large operators for better spacing
\NewDocumentCommand{\abs}{s o m}{%
    \IfBooleanTF{#1}{{}}{}%
    \IfValueTF{#2}{\ABS[#2]{#3}}{\ABS{#3}}}
\DeclarePairedDelimiter\expval{\langle}{\rangle}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}
\newcommand\given[1][]{\:#1\vert\:}